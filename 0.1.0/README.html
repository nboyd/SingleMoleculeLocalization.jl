<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="generator" content="Publish.jl" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="" />
    <title></title>
    <link rel="stylesheet" href="normalize.css" />
    <link rel="stylesheet" href="tabulator_simple.min.css" />
    <link rel="stylesheet" href="publish.css" />
    <link rel="stylesheet" href="default.min.css" />
    <script src="versions.js"></script>
    <script src="lunr.js"></script>
    <script src="highlight.min.js"></script>
    <script src="tabulator.min.js"></script>
    <script src="julia.min.js"></script>
    <script src="julia-repl.min.js"></script>
    <script src="publish.js"></script>
    
</head>
<body>
    <div class="menu">
        <svg id="menu-toggler" title="Contents" onclick="toggleIndexPage();" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M2 6C2 5.44772 2.44772 5 3 5H21C21.5523 5 22 5.44772 22 6C22 6.55228 21.5523 7 21 7H3C2.44772 7 2 6.55228 2 6Z" fill="currentColor" /><path d="M2 12.0322C2 11.4799 2.44772 11.0322 3 11.0322H21C21.5523 11.0322 22 11.4799 22 12.0322C22 12.5845 21.5523 13.0322 21 13.0322H3C2.44772 13.0322 2 12.5845 2 12.0322Z" fill="currentColor" /><path d="M3 17.0645C2.44772 17.0645 2 17.5122 2 18.0645C2 18.6167 2.44772 19.0645 3 19.0645H21C21.5523 19.0645 22 18.6167 22 18.0645C22 17.5122 21.5523 17.0645 21 17.0645H3Z" fill="currentColor" /></svg>
        <input id="search-input" placeholder="Search">
        <select id="version-selector"></select>
    </div>
    <main id="page"><article><h1 id="singlemoleculelocalization"><a href="#singlemoleculelocalization" class="anchor"></a>SingleMoleculeLocalization</h1>
<p>Fast estimators for high (and low!) density 2D <a href="https://en.wikipedia.org/wiki/Super-resolution_microscopy#Points_accumulation_for_imaging_in_nanoscale_topography_%28PAINT%29">single molecule localization microscopy</a> loosely inspired by <a href="https://arxiv.org/abs/1507.01562">ADCG</a>.</p>
<div class="admonition warning"><p class="admonition-title">Warning</p>
<p>This package uses the squared loss! This means it is only appropriate for relatively high SNR images with <em>zero-mean</em> backgrounds,
i.e. those generated by <a href="https://en.wikipedia.org/wiki/Total_internal_reflection_fluorescence_microscope">TIRF</a> microscopy.</p>
<p>You may need to apply a variance-stabilizing transform in addition to removing any background.</p>
</div>
<h2 id="simulation"><a href="#simulation" class="anchor"></a>Simulation</h2>
<p>A <a href="docstrings/SingleMoleculeLocalization.ForwardModel.html"><code>ForwardModel</code></a> describes the parameters of single molecule localization microscopy (SMLM) experiment.
For square images and an isotropic Gaussian point-spread function a model can be constructed as</p>
<pre><code output="false" cell="example" result="false" class="language-julia">using SingleMoleculeLocalization
using PlotlyJS
use_style!(:seaborn)
model = ForwardModel(1.5, 16)
</code></pre>
<p>This models a 16 by 16 image patch with an integrated Gaussian PSF with standard deviation of 1.5 pixels.</p>
<div class="admonition warning"><p class="admonition-title">Warning</p>
<p>Because <code>ForwardModel</code> uses statically-sized arrays, performance degrades <em>rapidly</em> with increasing patch size.</p>
</div>
<p>A single point source is represented as a <a href="docstrings/SingleMoleculeLocalization.PointSource.html"><code>PointSource</code></a>, with three
properties. <code>x</code> and <code>y</code> are the location of the source within an image, while
<code>intensity</code> is the brightness.</p>
<pre><code output="false" cell="example" result="false" class="language-julia">p = PointSource(1.0, 7.5, 4.7)
</code></pre>
<p>constructs a unit-intensity point source at the spatial location (2.5, 3.7).</p>
<p>We can apply the forward model to a point source to generate a noiseless image:</p>
<pre><code cell="example" class="language-julia">img = model(p)
plot(heatmap(z = img))
</code></pre>
<pre><code class="plaintext cell-output cell-result" class="language-plaintext">LoadError(&quot;string&quot;, 1, UndefVarError(:model))</code></pre>
<p>It’s also easy to generate a noisy image of a collection of sources:</p>
<pre><code cell="example" class="language-julia">true_sources = [PointSource(3.23, 2.12, 12.12), PointSource(3.0, 2.5, 2.8), PointSource(4.0, 8.0, 7.0)]
noiseless_img = model(true_sources)
img = noiseless_img + 0.01*randn(16,16)
plot(heatmap(z = img))
</code></pre>
<pre><code class="plaintext cell-output cell-result" class="language-plaintext">LoadError(&quot;string&quot;, 2, UndefVarError(:model))</code></pre>
<h2 id="localizing-small-image-patches"><a href="#localizing-small-image-patches" class="anchor"></a>Localizing small image patches</h2>
<p>For small patches (less than about 20 by 20) we provide an efficient estimator,
<code>PatchLocalizer</code>.</p>
<pre><code cell="example" class="language-julia">patchlocalizer = PatchLocalizer(model)
est_sources = patchlocalizer(img, 5, 1E-1)
s_true = scatter(;x=getproperty.(true_sources, :x).-0.5, y=getproperty.(true_sources, :y).-0.5, mode=&quot;markers&quot;)
s_est = scatter(;x=getproperty.(est_sources, :x).-0.5, y=getproperty.(est_sources, :y).-0.5, mode=&quot;markers&quot;, marker = attr(symbol = &quot;cross&quot;))
plot([heatmap(z = img), s_true, s_est])
</code></pre>
<pre><code class="plaintext cell-output cell-result" class="language-plaintext">LoadError(&quot;string&quot;, 1, UndefVarError(:model))</code></pre>
<p>The two arguments to <code>patchlocalizer</code> are the maximum number of source the algorithm will estimate and the minimum drop in the
loss function the algorithm will accept when adding a new source.
When the drop in the squared loss function from adding a new source falls below <code>1E-1</code>,
the algorithm will return the previously estimated sources.</p>
<h2 id="localizing-in-large-images"><a href="#localizing-in-large-images" class="anchor"></a>Localizing in large images</h2>
<p>For larger images we provide the <code>ImageLocalizer</code> type:</p>
<pre><code output="false" cell="example" result="false" class="language-julia">localizer = ImageLocalizer(1.5, 1E-1)
</code></pre>
<p>The first argument is again the standard deviation of the gaussian PSF,
while the second is the minimum drop parameter discussed above.</p>
<p><code>ImageLocalizer</code>’s can comfortably handle large images:</p>
<pre><code cell="example" class="language-julia"># Generate a random image
img = 0.01*randn(512, 512)
for i in 1:350
    source = PointSource(5.0+randn(), 7+rand(), 7+rand())
    x,y = rand(1:(512-15)),rand(1:(512-15))
    img[x:x+15, y:y+15] .+= model(source)
end
# Localize
est_sources = localizer(img)
s_est = scatter(;x=getproperty.(est_sources, :x).-0.5, y=getproperty.(est_sources, :y).-0.5, mode=&quot;markers&quot;, marker = attr(size = 3.0, symbol = &quot;cross&quot;, color=&quot;red&quot;))
plot([heatmap(z = img), s_est])
</code></pre>
<pre><code class="plaintext cell-output cell-result" class="language-plaintext">LoadError(&quot;string&quot;, 3, UndefVarError(:model))</code></pre>
</article>
        <div id="page-navigation">
            <a id="previous-page" title="Previous" href="README.html"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M16.2426 6.34317L14.8284 4.92896L7.75739 12L14.8285 19.0711L16.2427 17.6569L10.5858 12L16.2426 6.34317Z" fill="currentColor" /></svg></a>
            <a id="next-page" title="Next" href="docstrings.html"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10.5858 6.34317L12 4.92896L19.0711 12L12 19.0711L10.5858 17.6569L16.2427 12L10.5858 6.34317Z" fill="currentColor" /></svg></a>
        </div>
    </main>
    <nav id="toc"><ul>
<li><a href="README.html">Introduction</a></li>
<li><a href="docstrings.html">Documentation</a></li>
</ul>
</nav>
    <footer>
        Built with <a target="_blank" href="https://github.com/MichaelHatherly/Publish.jl">Publish.jl</a> and the <a target="_blank" href="https://julialang.org">Julia Language.</a>
    </footer>
    <script>hljs.initHighlightingOnLoad();</script>
</body>
</html>
